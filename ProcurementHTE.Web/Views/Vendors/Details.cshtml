@using Microsoft.AspNetCore.Authorization
@using ProcurementHTE.Core.Models
@using ProcurementHTE.Core.Authorization
@inject IAuthorizationService AuthZ
@model Vendor
@{
    ViewData["Title"] = "Vendor Details";
    var canEdit = await AuthZ.AuthorizeAsync(User, Permissions.WO.Edit);
    var canDelete = await AuthZ.AuthorizeAsync(User, Permissions.WO.Delete);
    Func<string, string> BadgeClass = s => (s ?? "").ToLower() switch {
        "active" => "bg-success-subtle text-success-emphasis border border-success-subtle",
        "inactive" => "bg-secondary-subtle text-secondary-emphasis border border-secondary-subtle",
        "suspended" => "bg-warning-subtle text-warning-emphasis border border-warning-subtle",
        _ => "bg-light text-body border"
    };
    string MaskNpwp(string npwp) {
        if (string.IsNullOrWhiteSpace(npwp))
            return "-";
        var d = new string(npwp.Where(char.IsDigit).ToArray());
        return d.Length <= 4 ? "****" : $"**** **** **** {d[^4..]}";
    }
}

<header class="mb-3">
    <div class="hstack flex-wrap justify-content-between mb-2">
        <h1 class="h3 mb-1">@Model.VendorName</h1>

        <button class="btn btn-primary d-md-none position-fixed bottom-0 end-0 mb-4 mb-md-0 me-4 me-md-0 z-3" type="button" id="buttonNavToggle">
            <i class="bi bi-three-dots-vertical"></i>
        </button>

        <div class="d-flex gap-2 flex-column flex-md-row bg-body p-3 p-md-0 mb-2 border rounded shadow group-nav-button" id="groupNavButton" role="group" aria-label="Button Action">
            <a asp-action="Edit" asp-route-id="@Model.VendorId" class="btn btn-outline-warning" role="button"><i class="bi bi-pencil-square"></i> Edit</a>
            <a asp-action="Delete" asp-route-id="@Model.VendorId" class="btn btn-outline-danger" role="button"><i class="bi bi-trash-fill"></i> Delete</a>
            <a asp-action="Index" class="btn btn-outline-secondary" role="button"><i class="bi bi-arrow-left"></i> Back to list</a>
        </div>
    </div>
</header>
<hr />

<div class="d-grid gap-md-3 wo-content">
    <div>
        @* Company Info *@
        <article class="card shadow-sm mb-3 rounded-4">
            <header class="card-header fw-semibold mt-2 bg-transparent border-bottom-0">
                <h2 class="card-title mb-0 h5"><i class="bi bi-building text-primary me-1"></i> Company Info</h2>
            </header>
            <hr class="mx-3 my-2" />

            <div class="card-body">
                <div class="row mb-0">
                    <dl class="col-6 mb-2">
                        <dt class="fw-semibold text-uppercase text-secondary">Vendor Name</dt>
                        <dd class="fw-medium text-secondary-emphasis">@Model.VendorName</dd>
                    </dl>

                    <dl class="col-6 mb-2">
                        <dt class="fw-semibold text-uppercase text-secondary">Vendor Code</dt>
                        <dd class="fw-medium text-secondary-emphasis">@Model.VendorCode</dd>
                    </dl>

                    <dl class="col-6 mb-2">
                        <dt class="fw-semibold text-uppercase text-secondary">NPWP</dt>
                        <dd class="fw-medium text-secondary-emphasis">@MaskNpwp(Model.NPWP)</dd>
                    </dl>

                    <dl class="col-6 mb-2">
                        <dt class="fw-semibold text-uppercase text-secondary">Created</dt>
                        <dd class="fw-medium text-secondary-emphasis">@Model.CreatedAt.ToString("d MMM yyyy")</dd>
                    </dl>
                </div>
            </div>
        </article>

        @* Notes *@
        <article class="card shadow-sm mb-3 rounded-4">
            <header class="card-header fw-semibold mt-2 bg-transparent border-bottom-0">
                <h2 class="card-title mb-0 h5"><i class="bi bi-stickies text-primary me-1"></i> Notes</h2>
            </header>
            <hr class="mx-3 my-2" />

            <div class="card-body">
                <p class="bg-info-subtle text-info-emphasis p-3 lh-base border-start border-info-subtle rounded-3 border-5">@(Model.Comment ?? "No note")</p>
            </div>
        </article>
    </div>

    <div>
        @* Address *@
        <article class="card shadow-sm mb-3 rounded-4">
            <header class="card-header fw-semibold mt-2 bg-transparent border-bottom-0">
                <h2 class="card-title mb-0 h5"><i class="bi bi-geo-alt text-primary me-1"></i> Address</h2>
            </header>
            <hr class="mx-3 my-2" />

            <div class="card-body">
                <div class="row mb-0 mb-0">
                    <dl class="col-6">
                        <dt class="fw-semibold text-uppercase text-secondary">Address</dt>
                        <dd class="fw-medium text-secondary-emphasis">@Model.Address</dd>
                    </dl>

                    <dl class="col-6">
                        <dt class="fw-semibold text-uppercase text-secondary">City</dt>
                        <dd class="fw-medium text-secondary-emphasis">@Model.City</dd>
                    </dl>
                    
                    <dl class="col-6">
                        <dt class="fw-semibold text-uppercase text-secondary">Province</dt>
                        <dd class="fw-medium text-secondary-emphasis">@Model.Province</dd>
                    </dl>

                    <dl class="col-6">
                        <dt class="fw-semibold text-uppercase text-secondary">Postal Code</dt>
                        <dd class="fw-medium text-secondary-emphasis">@Model.PostalCode</dd>
                    </dl>
                </div>
            </div>
        </article>

        @* Contacts *@
        <article class="card shadow-sm mb-3 rounded-4">
            <header class="card-header fw-semibold mt-2 bg-transparent border-bottom-0">
                <h2 class="card-title mb-0 h5"><i class="bi bi-person-lines-fill text-primary me-1"></i> Contacts</h2>
            </header>
            <hr class="mx-3 my-2" />

            <div class="card-body">
                <dl class="mb-0">
                    <dt class="fw-semibold text-uppercase text-secondary">Email</dt>
                    <dd class="fw-medium"><a href="mailto:@Model.Email" class="text-decoration-none">@Model.Email</a></dd>
                </dl>
            </div>
        </article>
    </div>
</div>

@section Scripts {
    <script>
        const toggleButtonGroup = document.getElementById("buttonNavToggle");
        const buttonGroupWrap = document.getElementById("groupNavButton");

        toggleButtonGroup.addEventListener("click", () => {
        buttonGroupWrap.classList.toggle("show");
        });
    </script>
}