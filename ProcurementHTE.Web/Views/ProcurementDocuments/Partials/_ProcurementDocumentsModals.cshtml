@model ProcurementHTE.Web.Models.ViewModels.ProcurementRequiredDocsVm

<!-- PDF Preview Modal -->
<div class="modal fade" id="pdfPreviewModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header border-0 pb-0">
                <div>
                    <h5 class="modal-title" id="previewModalTitle">Preview Dokumen</h5>
                    <small class="text-muted" id="previewFileName"></small>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body p-0">
                <div id="pdfLoadingContainer" class="text-center py-5">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-3 text-muted">Memuat dokumen...</p>
                </div>
                <div id="pdfErrorContainer" class="text-center py-5 d-none">
                    <i class="bi bi-exclamation-triangle-fill text-danger fs-1 mb-3"></i>
                    <p class="text-muted">Failed to load documents. Please try again.</p>
                </div>
                <iframe id="pdfPreviewFrame"
                        style="width: 100%; height: 75vh; border: none; display: none;"
                        title="PDF Preview">
                </iframe>
            </div>
            <div class="modal-footer border-0">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                <button type="button" class="btn btn-primary" id="downloadFromPreview">
                    <i class="bi bi-download"></i> Download
                </button>
            </div>
        </div>
    </div>
</div>

<!-- QR Modal -->
<div class="modal fade" id="qrModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-sm modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header border-0">
                <h5 class="modal-title">QR Code</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <img id="qrImg" src="" class="img-fluid border rounded mb-3" alt="QR Code">
            </div>
            <div class="modal-footer border-0 justify-content-center">
                <a id="btnDownloadQr" class="btn btn-outline-primary" download>
                    <i class="bi bi-download"></i> Download
                </a>
                <button type="button" class="btn btn-outline-secondary" id="btnPrintQr">
                    <i class="bi bi-printer"></i> Print
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Approval Timeline Modal -->
<div class="modal fade" id="approvalTimelineModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header border-0">
                <div>
                    <h5 class="modal-title"><i class="bi bi-diagram-3 me-2"></i>Approval Timeline</h5>
                    <small class="text-muted" id="approvalDocName"></small>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div id="approvalLoading" class="text-center py-5">
                <div class="spinner-border text-primary" role="status"></div>
                <p class="mt-3 text-muted">Memuat approval...</p>
            </div>

            <div id="approvalError" class="text-center py-5 d-none">
                <i class="bi bi-exclamation-triangle-fill text-danger fs-1 mb-3"></i>
                <p class="text-muted">Failed to load approval timeline.</p>
            </div>

            <div class="modal-body pt-0 d-none" id="approvalTimelineBody">
                <div class="mb-3">
                    <span id="docStatusBadge" class="badge rounded-pill bg-secondary">Status: &bull;</span>
                    <span id="currentGateBadge" class="badge rounded-pill bg-light text-dark border ms-1 d-none"></span>
                </div>

                <ul id="approvalStepper" class="timeline list-unstyled m-0"></ul>

                <div class="mt-3" id="nextApproverWrap" style="display:none;">
                    <span class="text-muted me-2">Next approver:</span>
                    <span id="nextApproverChips"></span>
                </div>
            </div>

            <div class="modal-footer border-0">
                <button type="button" class="btn btn-light" data-bs-dismiss="modal">Tutup</button>
            </div>
        </div>
    </div>
</div>

<!-- Hidden Delete Form -->
<form id="deleteForm" method="post" asp-controller="ProcurementDocuments" asp-action="Delete" style="display: none;">
    @Html.AntiForgeryToken()
    <input type="hidden" name="id" id="deleteDocId" />
    <input type="hidden" name="procurementId" id="deleteProcurementId" />
</form>
